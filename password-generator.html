<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Password Generator</title>
  <style>
    .container {
      margin: auto;
      width: 50%;
      min-width: 400px;
      max-width: 600px;
    }
    [type="checkbox"] {
      margin-right: 8px;
    }
    #length {
      width: 64px;
    }
    #length, #password {
      font-family: monospace;
      font-size: 14px;
    }
    #password {
      height: 200px;
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Password Generator</h2>
    <p>
      Letters<input id="letters" type="checkbox" checked>
      Numbers<input id="numbers" type="checkbox" checked>
      Symbols<input id="symbols" type="checkbox" checked>
      Spaces<input id="spaces" type="checkbox" checked>
    </p>
    <p>Length: <input id="length" type="number" min="16" value="30"> <button id="generate">Generate</button></p>
    <textarea id="password"></textarea>
  </div>
  <script>
  (function() {
    const chrs       = Array.from(Array(95).keys(), n => String.fromCharCode(n + 32))
        , lettersEl  = document.getElementById('letters')
        , numbersEl  = document.getElementById('numbers')
        , symbolsEl  = document.getElementById('symbols')
        , spacesEl   = document.getElementById('spaces')
        , lengthEl   = document.getElementById('length')
        , passwordEl = document.getElementById('password');

    const generate = (len, regex) => {
      let subset = chrs.filter(c => regex.test(c));
      let str = Array.from(crypto.getRandomValues(new Uint32Array(len)), n => {
        return subset[n % subset.length];
      }).join('');
      return str === str.trim() ? str : generate(len, regex);
    }

    const updatePassword = () => {
      let rawRegex =
          (lettersEl.checked ? '[A-Za-z]|' : '') +
          (numbersEl.checked ? '\\d|' : '') +
          (symbolsEl.checked ? '[^\\w ]|_|' : '') +
          (spacesEl.checked  ? ' |' : '');
      let regex = (rawRegex && rawRegex !== ' |') ? new RegExp(rawRegex.slice(0, -1)) : /./;
      let len = Number(lengthEl.value);
      let pwd = generate(len, regex);
      passwordEl.value = pwd;
    };

    document.getElementById('generate').addEventListener('click', updatePassword);
    lengthEl.addEventListener('keypress', (event) => {
      if (event.keyCode === 13) {
        updatePassword();
      }
    });
    lengthEl.focus();    
  })();
  </script>
</body>

</html>
